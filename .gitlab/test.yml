
coverage:
  stage: quality
  image: python:3.11
  parallel:
    matrix:
      - PYTHON:
          - "python:3.9"
          - "python:3.10"
          - "python:3.11"
  before_script:
    - pip install poetry==1.6.1
    - poetry export --with local | pip install --no-cache-dir -r /dev/stdin
  script:
    - find . -name \*.pyc -delete
    - make coverage
  coverage: '/(?i)total.*? (100(?:\.0+)?\%|[1-9]?\d(?:\.\d+)?\%)$/'
  artifacts:
    reports:
      coverage_report:
        coverage_format: cobertura
        path: coverage.xml
