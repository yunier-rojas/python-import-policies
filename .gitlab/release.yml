#release:
#  image: node:latest
#  stage: release
#  variables:
#    GITLAB_TOKEN: ${{ GITLAB_TOKEN }}
#    PYPI_TOKEN: ${{ PYPI_TOKEN }}
#  before_script:
#    - npm install
#    - git remote set-url --push origin https://gitlab-ci-token:${GITLAB_TOKEN}@gitlab.com/$CI_PROJECT_PATH.git
#  script:
#    - npx semantic-release


release:
  image: python:3.11
  stage: release
  variables:
    GITLAB_TOKEN: ${{ GITLAB_TOKEN }}
    PYPI_TOKEN: ${{ PYPI_TOKEN }}
    GIT_STRATEGY: clone
  before_script:
    - pip install poetry==1.6.1
    - poetry install --with=ci
    - git remote set-url --push origin https://gitlab-ci-token:${PROJECT_ACCESS_TOKEN}@gitlab.com/$CI_PROJECT_PATH.git
#    - git checkout -B "$CI_COMMIT_REF_NAME" "$CI_COMMIT_SHA"
  script:
    - make release
